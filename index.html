<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Эксперимент: Ко-адаптация</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f2f5;
      color: #1a1a2e;
      min-height: 100vh;
    }

    #root {
      display: flex;
      justify-content: center;
      padding: 40px 16px;
      min-height: 100vh;
    }

    .container {
      max-width: 680px;
      width: 100%;
    }

    .progress-bar-wrapper {
      background: #ddd;
      border-radius: 8px;
      height: 8px;
      margin-bottom: 32px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #6c63ff, #48c6ef);
      border-radius: 8px;
      transition: width 0.4s ease;
    }

    .card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      padding: 40px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card h2 {
      font-size: 1.5rem;
      margin-bottom: 8px;
      color: #1a1a2e;
    }

    .card h3 {
      font-size: 1.1rem;
      margin-bottom: 6px;
      color: #333;
    }

    .card .subtitle {
      font-size: 0.95rem;
      color: #666;
      margin-bottom: 24px;
      line-height: 1.5;
    }

    .card .author {
      font-size: 0.9rem;
      color: #888;
      margin-bottom: 4px;
    }

    .card .question-count {
      display: inline-block;
      background: #e8e6ff;
      color: #6c63ff;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      margin-bottom: 24px;
    }

    .stub-placeholder {
      background: #f8f8fc;
      border: 2px dashed #d0cfee;
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
      color: #999;
      font-size: 0.95rem;
      margin-bottom: 24px;
    }

    .btn {
      display: inline-block;
      padding: 14px 36px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #6c63ff, #48c6ef);
      color: #fff;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(108,99,255,0.35);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-done {
      background: linear-gradient(135deg, #43e97b, #38f9d7);
      color: #1a1a2e;
    }

    .btn-done:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(67,233,123,0.35);
    }

    .btn-row {
      display: flex;
      justify-content: center;
      margin-top: 24px;
    }

    /* Topic selection */
    .topic-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 8px;
    }

    .topic-item {
      padding: 16px 20px;
      border: 2px solid #e8e6ff;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 1rem;
      background: #fafaff;
    }

    .topic-item:hover {
      border-color: #6c63ff;
      background: #f0eeff;
    }

    .topic-item.selected {
      border-color: #6c63ff;
      background: #e8e6ff;
      font-weight: 600;
    }

    /* Radio options */
    .options-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 8px;
    }

    .option-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 18px;
      border: 2px solid #e8e6ff;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: #fafaff;
    }

    .option-item:hover {
      border-color: #6c63ff;
      background: #f0eeff;
    }

    .option-item.selected {
      border-color: #6c63ff;
      background: #e8e6ff;
    }

    .radio-circle {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: border-color 0.2s;
    }

    .option-item.selected .radio-circle {
      border-color: #6c63ff;
    }

    .radio-circle-inner {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #6c63ff;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .option-item.selected .radio-circle-inner {
      opacity: 1;
    }

    /* Textarea */
    .text-area {
      width: 100%;
      min-height: 120px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 16px;
      font-size: 1rem;
      font-family: inherit;
      resize: vertical;
      transition: border-color 0.2s;
      outline: none;
    }

    .text-area:focus {
      border-color: #6c63ff;
    }

    /* Input field */
    .input-field {
      width: 100%;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 12px 16px;
      font-size: 1rem;
      font-family: inherit;
      transition: border-color 0.2s;
      outline: none;
    }

    .input-field:focus {
      border-color: #6c63ff;
    }

    /* Concept fields */
    .concept-fields {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 20px;
      animation: fadeIn 0.4s ease;
    }

    .concept-field-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 0.95rem;
      color: #333;
    }

    .concept-field-group .hint {
      font-size: 0.8rem;
      color: #999;
      margin-bottom: 6px;
    }

    /* Semantic differential */
    .sd-block-title {
      font-size: 1.05rem;
      font-weight: 700;
      margin: 24px 0 8px 0;
      color: #6c63ff;
    }

    .sd-block-subtitle {
      font-size: 0.85rem;
      color: #888;
      margin-bottom: 16px;
    }

    .sd-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
    }

    .sd-label-left {
      width: 140px;
      text-align: right;
      font-size: 0.9rem;
      color: #666;
      flex-shrink: 0;
    }

    .sd-label-right {
      width: 140px;
      text-align: left;
      font-size: 0.9rem;
      color: #666;
      flex-shrink: 0;
    }

    .sd-scale {
      display: flex;
      gap: 4px;
      flex: 1;
      justify-content: center;
    }

    .sd-circle {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid #d0cfee;
      cursor: pointer;
      transition: all 0.15s ease;
      background: #fff;
    }

    .sd-circle:hover {
      border-color: #6c63ff;
      background: #f0eeff;
    }

    .sd-circle.active {
      background: #6c63ff;
      border-color: #6c63ff;
    }

    /* AI stub */
    .ai-stub {
      background: linear-gradient(135deg, #e0f7e9, #c8f7dc);
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
      margin-bottom: 24px;
    }

    .ai-stub p {
      font-size: 1.1rem;
      color: #2d6a4f;
      font-weight: 500;
    }

    /* Final screen */
    .final-screen {
      text-align: center;
    }

    .final-screen h2 {
      margin-bottom: 16px;
    }

    .step-label {
      font-size: 0.85rem;
      color: #aaa;
      margin-bottom: 8px;
    }

    /* TIPI-RU Likert table */
    .likert-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 24px;
    }

    .likert-table th {
      padding: 10px 4px;
      font-size: 0.85rem;
      color: #666;
      font-weight: 600;
      text-align: center;
      border-bottom: 2px solid #e0e0e0;
    }

    .likert-table th:first-child {
      text-align: left;
      width: auto;
    }

    .likert-table td {
      padding: 12px 4px;
      border-bottom: 1px solid #f0f0f0;
      text-align: center;
    }

    .likert-table td:first-child {
      text-align: left;
      font-size: 0.95rem;
      color: #333;
      padding-right: 12px;
    }

    .likert-table tr:hover {
      background: #fafaff;
    }

    .likert-radio {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 2px solid #d0cfee;
      cursor: pointer;
      transition: all 0.15s ease;
      background: #fff;
      display: inline-block;
    }

    .likert-radio:hover {
      border-color: #6c63ff;
      background: #f0eeff;
    }

    .likert-radio.active {
      background: #6c63ff;
      border-color: #6c63ff;
    }

    .likert-instruction {
      background: #f8f8fc;
      border-left: 4px solid #6c63ff;
      padding: 12px 16px;
      margin-bottom: 20px;
      border-radius: 0 8px 8px 0;
      font-size: 0.95rem;
      color: #444;
      line-height: 1.5;
    }

    @media (max-width: 600px) {
      #root {
        padding: 20px 12px;
      }

      .card {
        padding: 24px 16px;
        border-radius: 12px;
      }

      .card h2 {
        font-size: 1.3rem;
      }

      .card h3 {
        font-size: 1rem;
      }

      .btn {
        padding: 12px 28px;
        font-size: 0.95rem;
      }

      /* Semantic differential - адаптация */
      .sd-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto auto;
        gap: 8px;
        margin-bottom: 20px;
      }

      .sd-label-left {
        grid-column: 1;
        grid-row: 1;
        text-align: left;
        font-size: 0.85rem;
        width: auto;
      }

      .sd-label-right {
        grid-column: 2;
        grid-row: 1;
        text-align: right;
        font-size: 0.85rem;
        width: auto;
      }

      .sd-scale {
        grid-column: 1 / 3;
        grid-row: 2;
        width: 100%;
        justify-content: center;
        gap: 3px;
      }

      .sd-circle {
        width: 30px;
        height: 30px;
      }

      .sd-block-title {
        font-size: 0.95rem;
      }

      /* TIPI-RU таблица */
      .likert-table th,
      .likert-table td {
        padding: 8px 2px;
        font-size: 0.85rem;
      }

      .likert-table th:first-child,
      .likert-table td:first-child {
        font-size: 0.85rem;
        padding-right: 8px;
      }

      .likert-radio {
        width: 20px;
        height: 20px;
      }

      /* Финальная страница - кнопка копирования */
      .final-screen .input-field {
        font-size: 0.8rem !important;
      }

      .final-screen .btn {
        padding: 12px 16px !important;
        min-width: 90px !important;
        font-size: 0.85rem !important;
      }
    }

    .copy-link-row {
      display: flex;
      gap: 8px;
      align-items: stretch;
    }

    @media (max-width: 400px) {
      .card {
        padding: 20px 12px;
      }

      .card h2 {
        font-size: 1.2rem;
      }

      /* На очень маленьких экранах - вертикальная компоновка кнопки */
      .copy-link-row {
        flex-direction: column;
      }

      .copy-link-row .btn {
        width: 100%;
      }

      .sd-circle {
        width: 24px;
        height: 24px;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useCallback } = React;

    // ============ DATA ============

    const tipiItems = [
      'открытого, полного энтузиазма',
      'критичного, склонного спорить',
      'надёжного и дисциплинированного',
      'тревожного, меня легко расстроить',
      'открытого для нового опыта, сложного',
      'замкнутого, тихого',
      'сочувствующего, сердечного',
      'неорганизованного, беспечного',
      'спокойного, эмоционально устойчивого',
      'обыкновенного, не творческого',
    ];

    const questionnaires = [
      {
        title: 'Стиль саморегуляции поведения (ССПМ)',
        author: 'В.И Моросанова (1998, 2004)',
        count: '46 вопросов',
      },
      {
        title: 'Опросник «Вовлечённость в сферу искусственного интеллекта»',
        author: 'Леньков, Рубцова, Низамова (2025)',
        count: '19 вопросов',
      },
    ];

    const topics = [
      'Экология / раздельный сбор мусора',
      'Безопасность на дорогах',
      'Кибербуллинг',
      'Донорство крови',
    ];

    const paramQuestions = [
      {
        question: 'Кто герой ролика?',
        options: ['Ребёнок', 'Подросток', 'Взрослый', 'Пожилой', 'Нет конкретного героя'],
      },
      {
        question: 'Кому адресован ролик?',
        options: ['Подросткам', 'Молодёжи', 'Родителям', 'Широкой аудитории'],
      },
      {
        question: 'Формат ролика',
        options: ['15 сек', '30 сек', '1 мин', 'Длинный ролик'],
      },
      {
        question: 'Где размещается?',
        options: ['ТВ', 'Видеохостинг', 'Наружная реклама', 'Соцсети'],
      },
      {
        question: 'Главный приём',
        options: ['Личная история', 'Статистика', 'Метафора', 'Провокация', 'Юмор'],
      },
    ];

    const sdBlocks = [
      {
        title: 'Блок 1. Эмоциональная оценка',
        subtitle: 'аффективное отношение к концепту',
        pairs: [
          ['скучный', 'захватывающий'],
          ['отталкивающий', 'привлекательный'],
          ['холодный', 'тёплый'],
          ['безразличный', 'волнующий'],
        ],
      },
      {
        title: 'Блок 2. Когнитивная оценка',
        subtitle: 'ясность, убедительность, оригинальность',
        pairs: [
          ['запутанный', 'понятный'],
          ['банальный', 'оригинальный'],
          ['неубедительный', 'убедительный'],
          ['поверхностный', 'глубокий'],
        ],
      },
      {
        title: 'Блок 3. Поведенческий потенциал',
        subtitle: 'воспринимаемая эффективность',
        pairs: [
          ['бесполезный', 'полезный'],
          ['слабый', 'сильный'],
          ['не запоминающийся', 'запоминающийся'],
          ['не побуждает к действию', 'побуждает к действию'],
        ],
      },
    ];

    const TOTAL_SD_ITEMS = sdBlocks.reduce((s, b) => s + b.pairs.length, 0);

    // ============ STEPS ============
    // 0     – welcome screen
    // 1     – topic selection
    // 2..6  – param questions
    // 7     – idea text input
    // 8     – TIPI-RU
    // 9..10 – questionnaire stubs
    // 11    – AI interaction stub + concept fields
    // 12    – semantic differential
    // 13    – finish

    const TOTAL_STEPS = 14;

    // ============ COMPONENTS ============

    function ProgressBar({ step }) {
      const pct = Math.round((step / (TOTAL_STEPS - 1)) * 100);
      return (
        <div className="progress-bar-wrapper">
          <div className="progress-bar-fill" style={{ width: pct + '%' }} />
        </div>
      );
    }

    function WelcomeScreen({ onNext }) {
      return (
        <div className="card">
          <h2 style={{ marginBottom: 24 }}>Добро пожаловать!</h2>

          <div style={{ marginBottom: 24, lineHeight: 1.7, color: '#444' }}>
            <p style={{ marginBottom: 16, fontSize: '1.05rem' }}>
              Вы участвуете в исследовании, посвящённом тому, как люди придумывают идеи для социальной рекламы.
              Нам интересен сам процесс создания – как вы мыслите, какие решения принимаете и что получается в итоге.
            </p>
          </div>

          <div style={{
            background: '#f8f9ff',
            border: '1px solid #e8e6ff',
            borderRadius: '12px',
            padding: '20px 24px',
            marginBottom: 24
          }}>
            <h3 style={{ fontSize: '1.05rem', marginBottom: 12, color: '#333' }}>Что вас ждёт:</h3>
            <ul style={{
              margin: 0,
              paddingLeft: 20,
              lineHeight: 1.8,
              color: '#555'
            }}>
              <li style={{ marginBottom: 8 }}>Несколько коротких вопросов о вас</li>
              <li style={{ marginBottom: 8 }}>Работа над идеей для социальной рекламы</li>
              <li style={{ marginBottom: 8 }}>Оценка получившегося результата</li>
            </ul>
            <p style={{ margin: '12px 0 0 0', fontSize: '0.95rem', color: '#666' }}>
              ⏱ Участие займёт не более 20 минут
            </p>
          </div>

          <div style={{ marginBottom: 24, lineHeight: 1.7, color: '#555', fontSize: '0.95rem' }}>
            <p style={{ marginBottom: 12 }}>
              Правильных и неправильных ответов нет – нас интересуют именно ваши решения и впечатления.
            </p>
            <p style={{ marginBottom: 12 }}>
              В завершение мы попросим вас поделиться короткой ссылкой с несколькими знакомыми – это часть
              исследования, в которой другие люди оценивают рекламные идеи «свежим взглядом». Это займёт у них не более 5 минут.
            </p>
            <p style={{ marginBottom: 0 }}>
              Все данные анонимны и используются исключительно в научных целях.
            </p>
          </div>

          <div style={{
            background: '#fff9e6',
            border: '2px solid #ffd966',
            borderRadius: '10px',
            padding: '16px 20px',
            marginBottom: 24,
            textAlign: 'center'
          }}>
            <p style={{ margin: 0, fontWeight: 600, color: '#333', fontSize: '0.95rem' }}>
              Нажимая «Далее», вы подтверждаете добровольное согласие на участие
            </p>
          </div>

          <div className="btn-row">
            <button className="btn btn-primary" onClick={onNext}>Далее</button>
          </div>
        </div>
      );
    }

    function TipiRU({ stepLabel, responses, onChange, onNext }) {
      return (
        <div className="card">
          <p className="step-label">{stepLabel}</p>
          <span className="question-count">10 вопросов</span>
          <h2>Краткий личностный опросник TIPI-RU</h2>
          <p className="author">Адаптация: А. С. Сергеева, и др. (2016)</p>
          <br />
          <div className="likert-instruction">
            <strong>Я воспринимаю себя как</strong> человека...
            <br />Оцените, насколько каждое утверждение вам подходит (7 – полностью согласен, 1 – совершенно не согласен).
          </div>
          <div style={{ overflowX: 'auto' }}>
            <table className="likert-table">
              <thead>
                <tr>
                  <th>Я воспринимаю себя как</th>
                  {[7, 6, 5, 4, 3, 2, 1].map((v) => (
                    <th key={v}>{v}</th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {tipiItems.map((item, i) => (
                  <tr key={i}>
                    <td>{item}</td>
                    {[7, 6, 5, 4, 3, 2, 1].map((v) => (
                      <td key={v}>
                        <div
                          className={'likert-radio' + (responses[i] === v ? ' active' : '')}
                          onClick={() => onChange(i, v)}
                        />
                      </td>
                    ))}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          <div className="btn-row">
            <button className="btn btn-primary" onClick={onNext}>Далее</button>
          </div>
        </div>
      );
    }

    function QuestionnaireStub({ data, stepLabel, onNext }) {
      return (
        <div className="card">
          <p className="step-label">{stepLabel}</p>
          <span className="question-count">{data.count}</span>
          <h2>{data.title}</h2>
          <p className="author">{data.author}</p>
          <div className="stub-placeholder">
            Здесь будут вопросы опросника
          </div>
          <div className="btn-row">
            <button className="btn btn-primary" onClick={onNext}>Далее</button>
          </div>
        </div>
      );
    }

    function TopicSelection({ selected, onSelect, onNext }) {
      return (
        <div className="card">
          <p className="step-label">Шаг 1 из 13</p>
          <h2>Выберите тему социальной рекламы</h2>
          <p className="subtitle">Выберите одну тему, на основе которой вы будете разрабатывать концепцию ролика.</p>
          <div className="topic-list">
            {topics.map((t) => (
              <div
                key={t}
                className={'topic-item' + (selected === t ? ' selected' : '')}
                onClick={() => onSelect(t)}
              >
                {t}
              </div>
            ))}
          </div>
          <div className="btn-row">
            <button className="btn btn-primary" onClick={onNext}>Далее</button>
          </div>
        </div>
      );
    }

    function ParamQuestion({ data, stepLabel, selected, onSelect, onNext }) {
      return (
        <div className="card">
          <p className="step-label">{stepLabel}</p>
          <h2>{data.question}</h2>
          <p className="subtitle">Выберите один вариант</p>
          <div className="options-list">
            {data.options.map((opt) => (
              <div
                key={opt}
                className={'option-item' + (selected === opt ? ' selected' : '')}
                onClick={() => onSelect(opt)}
              >
                <div className="radio-circle">
                  <div className="radio-circle-inner" />
                </div>
                {opt}
              </div>
            ))}
          </div>
          <div className="btn-row">
            <button className="btn btn-primary" onClick={onNext}>Далее</button>
          </div>
        </div>
      );
    }

    function IdeaInput({ value, onChange, onNext }) {
      return (
        <div className="card">
          <p className="step-label">Шаг 7 из 13</p>
          <h2>Опишите вашу идею</h2>
          <p className="subtitle">Опишите в 2-3 предложениях, что будет происходить в рекламном ролике.</p>
          <textarea
            className="text-area"
            placeholder="Например: В ролике подросток идёт по школьному коридору и видит, как одноклассника травят в соцсетях..."
            value={value}
            onChange={(e) => onChange(e.target.value)}
          />
          <div className="btn-row">
            <button className="btn btn-primary" onClick={onNext}>Далее</button>
          </div>
        </div>
      );
    }

    function AIInteraction({ conceptFields, onFieldChange, onDone, showFields, onShowFields }) {
      const allFilled = conceptFields.title.trim() &&
        conceptFields.hero.trim() &&
        conceptFields.visual.trim() &&
        conceptFields.audience.trim() &&
        conceptFields.placement.trim();

      return (
        <div className="card">
          <p className="step-label">Шаг 11 из 13</p>
          <h2>Взаимодействие с ИИ</h2>
          <div className="ai-stub">
            <p>Здесь будет интерфейс взаимодействия с ИИ-ассистентом</p>
          </div>

          {!showFields && (
            <div className="btn-row" style={{ justifyContent: 'center' }}>
              <button className="btn btn-done" onClick={onShowFields}>
                Готово – завершить общение с ИИ
              </button>
            </div>
          )}

          {showFields && (
            <div className="concept-fields">
              <h3>Заполните структурированный концепт</h3>
              <p className="subtitle" style={{ marginBottom: 12 }}>
                На основе вашей работы с ИИ заполните итоговые поля концепции.
              </p>

              <div className="concept-field-group">
                <label>Название / слоган</label>
                <p className="hint">1-2 предложения</p>
                <input
                  className="input-field"
                  value={conceptFields.title}
                  onChange={(e) => onFieldChange('title', e.target.value)}
                  placeholder="Введите название или слоган ролика..."
                />
              </div>

              <div className="concept-field-group">
                <label>Герой и сюжет</label>
                <p className="hint">3-4 предложения</p>
                <textarea
                  className="text-area"
                  style={{ minHeight: 90 }}
                  value={conceptFields.hero}
                  onChange={(e) => onFieldChange('hero', e.target.value)}
                  placeholder="Опишите героя и сюжет ролика..."
                />
              </div>

              <div className="concept-field-group">
                <label>Визуальное решение</label>
                <p className="hint">2-3 предложения</p>
                <textarea
                  className="text-area"
                  style={{ minHeight: 80 }}
                  value={conceptFields.visual}
                  onChange={(e) => onFieldChange('visual', e.target.value)}
                  placeholder="Опишите визуальный стиль, цветовые решения, атмосферу..."
                />
              </div>

              <div className="concept-field-group">
                <label>Целевая аудитория</label>
                <p className="hint">1 предложение</p>
                <input
                  className="input-field"
                  value={conceptFields.audience}
                  onChange={(e) => onFieldChange('audience', e.target.value)}
                  placeholder="На кого рассчитан ролик..."
                />
              </div>

              <div className="concept-field-group">
                <label>Где размещается и формат</label>
                <p className="hint">1 предложение</p>
                <input
                  className="input-field"
                  value={conceptFields.placement}
                  onChange={(e) => onFieldChange('placement', e.target.value)}
                  placeholder="Платформа и хронометраж..."
                />
              </div>

              <div className="btn-row">
                <button className="btn btn-primary" onClick={onDone}>
                  Далее
                </button>
              </div>
            </div>
          )}
        </div>
      );
    }

    function SemanticDifferential({ responses, onChange, onNext }) {
      const allAnswered = Object.keys(responses).length === TOTAL_SD_ITEMS;
      let idx = 0;

      return (
        <div className="card">
          <p className="step-label">Шаг 12 из 13</p>
          <h2>Семантический дифференциал</h2>
          <p className="subtitle">Оцените созданную концепцию по каждой шкале, выбрав одну из 7 позиций.</p>

          {sdBlocks.map((block) => (
            <div key={block.title}>
              <div className="sd-block-title">{block.title}</div>
              <div className="sd-block-subtitle">{block.subtitle}</div>
              {block.pairs.map(([left, right]) => {
                const key = left + '–' + right;
                const currentIdx = idx++;
                return (
                  <div className="sd-row" key={key}>
                    <div className="sd-label-left">{left}</div>
                    <div className="sd-scale">
                      {[1, 2, 3, 4, 5, 6, 7].map((v) => (
                        <div
                          key={v}
                          className={'sd-circle' + (responses[key] === v ? ' active' : '')}
                          onClick={() => onChange(key, v)}
                        />
                      ))}
                    </div>
                    <div className="sd-label-right">{right}</div>
                  </div>
                );
              })}
            </div>
          ))}

          <div className="btn-row">
            <button className="btn btn-primary" onClick={onNext}>
              Завершить
            </button>
          </div>
        </div>
      );
    }

    function FinishScreen() {
      const [copied, setCopied] = React.useState(false);

      // Генерация уникальной ссылки
      const uniqueId = React.useMemo(() => {
        return Math.random().toString(36).substring(2, 10) + Date.now().toString(36);
      }, []);

      const shareUrl = `${window.location.origin}${window.location.pathname}?eval=${uniqueId}`;

      const handleCopy = () => {
        navigator.clipboard.writeText(shareUrl).then(() => {
          setCopied(true);
          setTimeout(() => setCopied(false), 2000);
        });
      };

      return (
        <div className="card final-screen">
          <h2 style={{ marginBottom: 16 }}>Спасибо за участие!</h2>
          <p className="subtitle" style={{ marginBottom: 32 }}>
            Ваши ответы были сохранены. Вы завершили эксперимент.
          </p>

          <div style={{
            background: '#f8f9ff',
            border: '1px solid #e8e6ff',
            borderRadius: '12px',
            padding: '24px',
            marginBottom: 24,
            textAlign: 'left'
          }}>
            <h3 style={{ fontSize: '1.1rem', marginBottom: 16, color: '#333', lineHeight: 1.5 }}>
              Для завершения исследования просим вас поделиться данной ссылкой с пятью знакомыми
            </h3>
            <p style={{ fontSize: '0.95rem', color: '#666', marginBottom: 20, lineHeight: 1.6 }}>
              Они проведут независимую оценку разработанной вами концепции рекламы. Это важная часть исследования.
            </p>

            <div className="copy-link-row">
              <input
                type="text"
                readOnly
                value={shareUrl}
                className="input-field"
                style={{
                  flex: 1,
                  fontSize: '0.9rem',
                  background: '#fff',
                  cursor: 'text'
                }}
                onClick={(e) => e.target.select()}
              />
              <button
                className="btn btn-primary"
                onClick={handleCopy}
                style={{
                  padding: '12px 24px',
                  whiteSpace: 'nowrap',
                  minWidth: 100
                }}
              >
                {copied ? '✓ Скопировано' : 'Копировать'}
              </button>
            </div>
          </div>

          <p style={{ fontSize: '0.9rem', color: '#888', margin: 0 }}>
            Вы можете закрыть эту страницу
          </p>
        </div>
      );
    }

    // ============ APP ============

    function App() {
      const [step, setStep] = useState(0);
      const [topic, setTopic] = useState('');
      const [params, setParams] = useState({});
      const [idea, setIdea] = useState('');
      const [showConceptFields, setShowConceptFields] = useState(false);
      const [conceptFields, setConceptFields] = useState({
        title: '', hero: '', visual: '', audience: '', placement: '',
      });
      const [tipiResponses, setTipiResponses] = useState({});
      const [sdResponses, setSdResponses] = useState({});

      const next = useCallback(() => setStep((s) => s + 1), []);

      const handleParamSelect = (questionIdx, value) => {
        setParams((prev) => ({ ...prev, [questionIdx]: value }));
      };

      const handleTipiChange = (idx, value) => {
        setTipiResponses((prev) => ({ ...prev, [idx]: value }));
      };

      const handleConceptField = (field, value) => {
        setConceptFields((prev) => ({ ...prev, [field]: value }));
      };

      const handleSdChange = (key, value) => {
        setSdResponses((prev) => ({ ...prev, [key]: value }));
      };

      const renderStep = () => {
        // Step 0: Welcome screen
        if (step === 0) {
          return <WelcomeScreen onNext={next} />;
        }

        // Step 1: Topic selection
        if (step === 1) {
          return (
            <TopicSelection
              selected={topic}
              onSelect={setTopic}
              onNext={next}
            />
          );
        }

        // Steps 2-6: Parameter questions
        if (step >= 2 && step <= 6) {
          const qIdx = step - 2;
          return (
            <ParamQuestion
              data={paramQuestions[qIdx]}
              stepLabel={`Шаг ${step} из 13`}
              selected={params[qIdx] || ''}
              onSelect={(v) => handleParamSelect(qIdx, v)}
              onNext={next}
            />
          );
        }

        // Step 7: Idea input
        if (step === 7) {
          return (
            <IdeaInput
              value={idea}
              onChange={setIdea}
              onNext={next}
            />
          );
        }

        // Step 8: TIPI-RU
        if (step === 8) {
          return (
            <TipiRU
              stepLabel="Шаг 8 из 13"
              responses={tipiResponses}
              onChange={handleTipiChange}
              onNext={next}
            />
          );
        }

        // Steps 9-10: Questionnaire stubs
        if (step >= 9 && step <= 10) {
          return (
            <QuestionnaireStub
              data={questionnaires[step - 9]}
              stepLabel={`Шаг ${step} из 13`}
              onNext={next}
            />
          );
        }

        // Step 11: AI interaction + concept fields
        if (step === 11) {
          return (
            <AIInteraction
              conceptFields={conceptFields}
              onFieldChange={handleConceptField}
              onDone={next}
              showFields={showConceptFields}
              onShowFields={() => setShowConceptFields(true)}
            />
          );
        }

        // Step 12: Semantic differential
        if (step === 12) {
          return (
            <SemanticDifferential
              responses={sdResponses}
              onChange={handleSdChange}
              onNext={next}
            />
          );
        }

        // Step 13: Finish
        return <FinishScreen />;
      };

      return (
        <div className="container">
          <ProgressBar step={step} />
          {renderStep()}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
